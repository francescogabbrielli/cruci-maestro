  <table class="schema noselect" tabindex="1" (focus)="onFocus()" (blur)="onBlur()">
    <tr *ngFor="let row of service.cells; index as i; last as lastRow">
      <td *ngFor="let cell of row; index as j; last as lastColumn">
        <div *ngIf="j==state.x && i==state.y" class="cursor"></div>
        <div id="cell-{{i}}-{{j}}" class="cell"
          [ngClass]="{
              'word-sh': state.horizontal && selection.startsWith(j,i),
              'word-h': state.horizontal && selection.contains(j,i),
              'word-eh': state.horizontal && selection.endsWith(j,i),
              'word-sv': !state.horizontal && selection.startsWith(j,i),
              'word-v': !state.horizontal && selection.contains(j,i),
              'word-ev': !state.horizontal && selection.endsWith(j,i),
              'block': cell==='.',
              'focused': state.focused && cell!=='.'
              }"
          (mousedown)="prepareDrag(i, j, lastRow && lastColumn, $event)">
          {{cell}}
        </div>
      </td>
    </tr>
  </table>
  <defs [state]="state" [selection]="selection"></defs>
  <span tabindex="3" onFocus="document.querySelector('.schema').focus()"></span>
